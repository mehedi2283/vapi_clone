{
  "note": "Copy and run the SQL below in your Supabase SQL Editor. This fixes the 'Could not find password column' error.",
  "sql": "\n-- 1. Add password column if it doesn't exist\nDO $$\nBEGIN\n    IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'organizations' AND column_name = 'password') THEN\n        ALTER TABLE public.organizations ADD COLUMN password TEXT;\n    END IF;\nEND $$;\n\n-- 2. Force PostgREST schema cache reload\nNOTIFY pgrst, 'reload config';\n\n-- 3. Re-run Policy Setup (Just in case)\nALTER TABLE public.organizations ENABLE ROW LEVEL SECURITY;\n\nCREATE OR REPLACE FUNCTION public.is_admin()\nRETURNS BOOLEAN AS $$\n  SELECT EXISTS (\n    SELECT 1 FROM public.organizations\n    WHERE id = auth.uid() AND role = 'admin'\n  );\n$$ LANGUAGE sql SECURITY DEFINER;\n\nDROP POLICY IF EXISTS \"Read Access\" ON public.organizations;\nCREATE POLICY \"Read Access\" ON public.organizations\nFOR SELECT USING (auth.uid() = id OR is_admin());\n\nDROP POLICY IF EXISTS \"Update Access\" ON public.organizations;\nCREATE POLICY \"Update Access\" ON public.organizations\nFOR UPDATE USING (auth.uid() = id OR is_admin());\n\nDROP POLICY IF EXISTS \"Insert Access\" ON public.organizations;\nCREATE POLICY \"Insert Access\" ON public.organizations\nFOR INSERT WITH CHECK (auth.uid() = id OR is_admin());\n\nDROP POLICY IF EXISTS \"Delete Access\" ON public.organizations;\nCREATE POLICY \"Delete Access\" ON public.organizations\nFOR DELETE USING (is_admin());\n\n-- 4. Ensure Trigger handles the new schema correctly\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER AS $$\nBEGIN\n  INSERT INTO public.organizations (id, name, email, role, plan, credits, usage_cost, status)\n  VALUES (\n    new.id,\n    COALESCE(new.raw_user_meta_data->>'org_name', 'My Organization'),\n    new.email,\n    'user',\n    'trial',\n    10.00,\n    0.00,\n    'active'\n  )\n  ON CONFLICT (id) DO NOTHING;\n  RETURN new;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;"
}